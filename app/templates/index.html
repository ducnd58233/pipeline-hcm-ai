{% extends "base.html" %}
{% block content %}

<script>
    document.body.addEventListener('htmx:wsConnected', function (evt) {
        console.log('WebSocket connected');
    });

    document.body.addEventListener('htmx:wsAfterSend', function (event) {
        var checkbox = event.detail.elt;
        var frameId = checkbox.value;
        var isChecked = checkbox.checked;

        // Cập nhật UI dựa trên trạng thái mới của checkbox
        var frameCard = document.getElementById('frame-' + frameId);
        if (frameCard) {
            if (isChecked) {
                frameCard.classList.add('selected');
            } else {
                frameCard.classList.remove('selected');
            }
        }
    });

    document.body.addEventListener('htmx:wsAfterMessage', function (event) {
        var data = JSON.parse(event.detail.message);
        if (data.action === 'update_frame') {
            var checkbox = document.getElementById('checkbox-' + data.frame_id);
            if (checkbox) {
                checkbox.checked = data.selected;
            }
            var frameCard = document.getElementById('frame-' + data.frame_id);
            if (frameCard) {
                if (data.selected) {
                    frameCard.classList.add('selected');
                } else {
                    frameCard.classList.remove('selected');
                }
            }
        }
    });
</script>


<h1>Video Retrieval System</h1>

{% include 'components/search_bar.html' %}

<h2>Selected Frames</h2>
<div id="selected-frames" hx-get="/get_selected_frames" hx-trigger="load, frameSelected from:body" hx-target="this">
</div>

<h2>Search Results</h2>
<div id="search-results">
    <p>Enter a search query to see results.</p>
</div>

<div id="confirm-submit-modal" hx-swap-oob="true"></div>

{% endblock %}